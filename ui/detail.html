<!doctype html>
<html lang='en'>

<head>
    <meta charset='utf-8'>
    <meta name='viewport' content='width=device-width,initial-scale=1'>
    <title>{{ arxiv_id }} – Summary</title>
    <link rel="stylesheet" href="{{ url_for('base_css') }}">
    <link rel="icon" href="/favicon.svg" type="image/svg+xml">
    <link rel="icon" href="/favicon.ico" sizes="any">
</head>

<body>
    <header style="display:flex;align-items:center;justify-content:space-between;gap:1rem;">
        <h1 style="margin:0;"><a href='{{ url_for("index") }}'>← 返回列表</a></h1>
        <div class="topbar-group">
          <span class="topbar-divider"></span>
          <button id="theme-toggle" class="topbar-btn icon-btn" type="button" aria-label="切换主题" title="切换到夜间模式" data-icon-light="🌙" data-icon-dark="☀️">🌙</button>
        </div>
    </header>
    <main>
        <article class='markdown-body'>
            {{ content | safe }}
        </article>
        <p style='text-align:center;margin-top:2rem;'>
            <a id='pdf-link' target='_blank' href='https://arxiv.org/pdf/{{ arxiv_id }}.pdf'>📄 打开原文 PDF</a>
        </p>
    </main>
    <script>
      // --- theme: init & toggle ---
      (function() {
        const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        const saved = localStorage.getItem('theme');
        const theme = saved === 'dark' || saved === 'light' ? saved : (prefersDark ? 'dark' : 'light');
        const apply = (t) => {
          document.documentElement.setAttribute('data-theme', t === 'dark' ? 'dark' : 'light');
          const btn = document.getElementById('theme-toggle');
          if (btn) {
            const icon = t === 'dark' ? btn.getAttribute('data-icon-dark') : btn.getAttribute('data-icon-light');
            btn.textContent = icon || (t === 'dark' ? '☀️' : '🌙');
            btn.setAttribute('title', t === 'dark' ? '切换到日间模式' : '切换到夜间模式');
            btn.setAttribute('aria-label', t === 'dark' ? '切换到日间模式' : '切换到夜间模式');
          }
        };
        apply(theme);
        document.addEventListener('DOMContentLoaded', () => apply(document.documentElement.getAttribute('data-theme') || theme));
        document.getElementById('theme-toggle')?.addEventListener('click', () => {
          const current = document.documentElement.getAttribute('data-theme') || 'light';
          const next = current === 'dark' ? 'light' : 'dark';
          localStorage.setItem('theme', next);
          apply(next);
        });
      })();

      // pdf click event (core)
      document.getElementById('pdf-link')?.addEventListener('click', (ev) => {
        const href = ev.currentTarget.getAttribute('href');
        const payload = {type:'open_pdf', arxiv_id: '{{ arxiv_id }}', meta:{href}, ts: new Date().toISOString(), tz_offset_min: new Date().getTimezoneOffset()};
        navigator.sendBeacon('/event', JSON.stringify(payload));
      });
    </script>
</body>

</html>