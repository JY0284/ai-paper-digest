<!doctype html>
<html lang='en'>

<head>
    <meta charset='utf-8'>
    <meta name='viewport' content='width=device-width,initial-scale=1'>
    <title>{{ arxiv_id }} – Summary</title>
    <link rel="stylesheet" href="{{ url_for('base_css') }}">
    <link rel="icon" href="/favicon.svg" type="image/svg+xml">
    <link rel="icon" href="/favicon.ico" sizes="any">
</head>

<body>
    <header style="display:flex;align-items:center;justify-content:space-between;gap:1rem;">
        <h1 style="margin:0;"><a href='{{ url_for("index") }}'>← 返回列表</a></h1>
        <div class="topbar-group">
          <span class="topbar-divider"></span>
          <button id="theme-toggle" class="topbar-btn icon-btn" type="button" aria-label="切换主题" title="切换到夜间模式" data-icon-light="🌙" data-icon-dark="☀️">🌙</button>
        </div>
    </header>
    <main>
        {% if tags and tags|length %}
        <form class="tag-row" method="GET" action="{{ url_for('index') }}" style="margin: .2rem 0 1rem; align-items:center; gap:.35rem;">
          {% for tg in tags %}
            <a class="tag-chip" href='{{ url_for("index") }}?tag={{ tg }}'>{{ tg }}</a>
          {% endfor %}
          <span class="muted" style="margin:0 .25rem 0 .5rem;">或 搜索:</span>
          <input type="text" name="q" placeholder="模糊搜索标签" class="tag-input" />
          <button type="submit" class="topbar-btn">筛选</button>
        </form>
        {% endif %}
        <article class='markdown-body'>
            {{ content | safe }}
        </article>
        <p style='text-align:center;margin-top:2rem;'>
            <a id='pdf-link' target='_blank' href='https://arxiv.org/pdf/{{ arxiv_id }}.pdf'>📄 打开原文 PDF</a>
        </p>
    </main>
    <script>
      // --- theme: init & toggle ---
      (function() {
        const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        const saved = localStorage.getItem('theme');
        const theme = saved === 'dark' || saved === 'light' ? saved : (prefersDark ? 'dark' : 'light');
        const apply = (t) => {
          document.documentElement.setAttribute('data-theme', t === 'dark' ? 'dark' : 'light');
          const btn = document.getElementById('theme-toggle');
          if (btn) {
            const icon = t === 'dark' ? btn.getAttribute('data-icon-dark') : btn.getAttribute('data-icon-light');
            btn.textContent = icon || (t === 'dark' ? '☀️' : '🌙');
            btn.setAttribute('title', t === 'dark' ? '切换到日间模式' : '切换到夜间模式');
            btn.setAttribute('aria-label', t === 'dark' ? '切换到日间模式' : '切换到夜间模式');
          }
        };
        apply(theme);
        document.addEventListener('DOMContentLoaded', () => apply(document.documentElement.getAttribute('data-theme') || theme));
        document.getElementById('theme-toggle')?.addEventListener('click', () => {
          const current = document.documentElement.getAttribute('data-theme') || 'light';
          const next = current === 'dark' ? 'light' : 'dark';
          localStorage.setItem('theme', next);
          apply(next);
        });
      })();

      // pdf click event (core)
      document.getElementById('pdf-link')?.addEventListener('click', (ev) => {
        const href = ev.currentTarget.getAttribute('href');
        const payload = {type:'open_pdf', arxiv_id: '{{ arxiv_id }}', meta:{href}, ts: new Date().toISOString(), tz_offset_min: new Date().getTimezoneOffset()};
        navigator.sendBeacon('/event', JSON.stringify(payload));
      });
    </script>
    <style>
      .tag-row { display: flex; flex-wrap: wrap; gap: .35rem; }
      .tag-chip {
        display: inline-flex; align-items: center; gap: .35rem;
        padding: .14rem .5rem; border-radius: 999px; font-size: .8rem;
        background: var(--action-bg); color: var(--action-text); text-decoration: none;
        border: 1px solid var(--btn-border);
      }
      .tag-input { padding: .25rem .5rem; border-radius: 6px; border: 1px solid var(--btn-border); background: var(--bg); color: var(--text); }
    </style>
</body>

</html>